<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoGrader Smart Scraper</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="enhanced-popup.css">
</head>

<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg width="20" height="20" viewBox="0 0 32 32" fill="none">
                        <rect width="32" height="32" rx="8" fill="white" fill-opacity="0.15" />
                        <path d="M16 6L22 11L16 16L10 11L16 6Z" fill="white" />
                        <path d="M16 16L22 21L16 26L10 21L16 16Z" fill="white" opacity="0.65" />
                    </svg>
                </div>
                <div class="logo-text">
                    <h1>AutoGrader Scraper</h1>
                    <p class="subtitle">استخراج ذكي للبيانات</p>
                </div>
            </div>
            <div class="header-right">
                <div class="connection-badge" id="connectionStatus">
                    <span class="status-dot" id="statusDot"></span>
                    <span class="status-text" id="statusText">جاري الفحص...</span>
                </div>
            </div>
        </header>

        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-btn active" id="tabExtract" data-tab="extract">
                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 2L3 7v11h14V7L10 2zm0 2.5l5 3.5v9H5v-9l5-3.5z" />
                </svg>
                الاستخراج
            </button>
            <button class="tab-btn" id="tabHistory" data-tab="history">
                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M10 2C5.58 2 2 5.58 2 10s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm.5 9H9V5h1.5v6zm0 3H9v-1.5h1.5V14z" />
                </svg>
                السجل
            </button>
            <button class="tab-btn" id="tabSettings" data-tab="settings">
                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                    <path
                        d="M17.5 11.5h-.9a6.6 6.6 0 0 0-.6-1.5l.6-.6a.5.5 0 0 0 0-.7l-1.3-1.3a.5.5 0 0 0-.7 0l-.6.6a6.6 6.6 0 0 0-1.5-.6v-.9a.5.5 0 0 0-.5-.5h-1.5a.5.5 0 0 0-.5.5v.9c-.5.1-1 .3-1.5.6l-.6-.6a.5.5 0 0 0-.7 0L6.2 9.2a.5.5 0 0 0 0 .7l.6.6c-.3.5-.5 1-.6 1.5h-.9a.5.5 0 0 0-.5.5V13a.5.5 0 0 0 .5.5h.9c.1.5.3 1 .6 1.5l-.6.6a.5.5 0 0 0 0 .7l1.3 1.3c.2.2.5.2.7 0l.6-.6c.5.3 1 .5 1.5.6v.9c0 .3.2.5.5.5H11a.5.5 0 0 0 .5-.5v-.9c.5-.1 1-.3 1.5-.6l.6.6c.2.2.5.2.7 0l1.3-1.3a.5.5 0 0 0 0-.7l-.6-.6c.3-.5.5-1 .6-1.5h.9a.5.5 0 0 0 .5-.5v-1.5a.5.5 0 0 0-.5-.5zM10 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" />
                </svg>
                الإعدادات
            </button>
        </nav>

        <!-- Tab Content -->
        <main class="main-content">

            <!-- ===== EXTRACT TAB ===== -->
            <div class="tab-panel active" id="panelExtract">

                <!-- Step 1: Element Selection -->
                <section class="card" id="selectionCard">
                    <div class="card-header">
                        <div class="step-badge">1</div>
                        <div class="card-title-group">
                            <h2>تحديد العناصر</h2>
                            <span class="card-desc">اختر عناصر الصفحة أو استخدم الاستخراج التلقائي</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="button-group">
                            <button class="btn btn-primary" id="selectElementsBtn">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 3L3 10L10 17L17 10L10 3Z" />
                                </svg>
                                تحديد يدوي
                            </button>
                            <button class="btn btn-secondary" id="autoSelectBtn">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path
                                        d="M10 2C5.58 2 2 5.58 2 10C2 14.42 5.58 18 10 18C14.42 18 18 14.42 18 10C18 5.58 14.42 2 10 2ZM10 16C6.69 16 4 13.31 4 10C4 6.69 6.69 4 10 4C13.31 4 16 6.69 16 10C16 13.31 13.31 16 10 16Z" />
                                </svg>
                                استخراج تلقائي
                            </button>
                        </div>

                        <!-- Selected Elements List -->
                        <div class="selected-elements" id="selectedElementsList" style="display: none;">
                            <div class="list-header">
                                <div class="list-header-left">
                                    <span class="count-badge" id="elementsCount">0</span>
                                    <span class="list-label">عنصر محدد</span>
                                </div>
                                <button class="btn-icon danger" id="clearElementsBtn" title="مسح الكل">
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M2 4h12M6 4V2h4v2M4 4v10h8V4H4zm3 3v5M9 7v5" stroke="currentColor"
                                            stroke-width="1.5" fill="none" stroke-linecap="round" />
                                    </svg>
                                    مسح الكل
                                </button>
                            </div>
                            <ul class="elements-list" id="elementsList"></ul>
                        </div>
                    </div>
                </section>

                <!-- Step 2: Extraction Options -->
                <section class="card" id="optionsCard">
                    <div class="card-header">
                        <div class="step-badge">2</div>
                        <div class="card-title-group">
                            <h2>خيارات الاستخراج</h2>
                            <span class="card-desc">خصّص عملية الاستخراج</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="options-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" id="cleanDataOption" checked>
                                <span class="checkmark"></span>
                                <span>تنظيف البيانات</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="removeDuplicatesOption" checked>
                                <span class="checkmark"></span>
                                <span>إزالة التكرارات</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="validateDataOption" checked>
                                <span class="checkmark"></span>
                                <span>التحقق من البيانات</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeMetadataOption">
                                <span class="checkmark"></span>
                                <span>تضمين البيانات الوصفية</span>
                            </label>
                        </div>
                    </div>
                </section>

                <!-- Step 3: Extract & Send -->
                <section class="card" id="actionCard">
                    <div class="card-header">
                        <div class="step-badge">3</div>
                        <div class="card-title-group">
                            <h2>استخراج وإرسال</h2>
                            <span class="card-desc">أرسل البيانات إلى AutoGrader</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success btn-large" id="extractAndSendBtn" disabled>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M22 2L11 13M22 2L15 22L11 13M11 13L2 9L22 2" />
                            </svg>
                            استخراج وإرسال إلى AutoGrader
                        </button>

                        <div class="secondary-actions">
                            <button class="btn btn-outline btn-sm" id="previewBtn" disabled>
                                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                                    <path
                                        d="M10 4C5 4 1.73 7.11 1 10C1.73 12.89 5 16 10 16C15 16 18.27 12.89 19 10C18.27 7.11 15 4 10 4ZM10 14C7.24 14 5 11.76 5 10C5 8.24 7.24 6 10 6C12.76 6 15 8.24 15 10C15 11.76 12.76 14 10 14ZM10 8C8.9 8 8 8.9 8 10C8 11.1 8.9 12 10 12C11.1 12 12 11.1 12 10C12 8.9 11.1 8 10 8Z" />
                                </svg>
                                معاينة
                            </button>
                            <button class="btn btn-outline btn-sm" id="exportJsonBtn" disabled>
                                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M3 17h14v-1.5H3V17zM10 14.5l4.5-4.5H11V3H9v7H5.5L10 14.5z" />
                                </svg>
                                JSON
                            </button>
                            <button class="btn btn-outline btn-sm" id="exportCsvBtn" disabled>
                                <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                                    <path
                                        d="M17 12V17H3V12H1V17C1 18.1 1.9 19 3 19H17C18.1 19 19 18.1 19 17V12H17ZM10 15L15 10H12V3H8V10H5L10 15Z" />
                                </svg>
                                CSV
                            </button>
                        </div>

                        <!-- Progress Bar -->
                        <div class="progress-container" id="progressContainer" style="display: none;">
                            <div class="progress-header">
                                <span class="progress-text" id="progressText">جاري الاستخراج...</span>
                                <span class="progress-percent" id="progressPercent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>

                        <!-- Extraction Stats -->
                        <div class="stats-row" id="extractionStats" style="display: none;">
                            <div class="stat-chip" id="statFields">
                                <span class="stat-value">0</span>
                                <span class="stat-label">حقل</span>
                            </div>
                            <div class="stat-chip" id="statEntities">
                                <span class="stat-value">0</span>
                                <span class="stat-label">كيان</span>
                            </div>
                            <div class="stat-chip" id="statForms">
                                <span class="stat-value">0</span>
                                <span class="stat-label">نموذج</span>
                            </div>
                            <div class="stat-chip" id="statTables">
                                <span class="stat-value">0</span>
                                <span class="stat-label">جدول</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ===== HISTORY TAB ===== -->
            <div class="tab-panel" id="panelHistory">
                <div class="history-header">
                    <h3>سجل الاستخراجات</h3>
                    <button class="btn btn-outline btn-sm" id="clearHistoryBtn">مسح السجل</button>
                </div>
                <div class="history-list" id="historyList">
                    <div class="empty-state">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5">
                            <circle cx="12" cy="12" r="10" />
                            <path d="M12 8v4M12 16h.01" />
                        </svg>
                        <p>لا يوجد سجل استخراجات بعد</p>
                    </div>
                </div>
            </div>

            <!-- ===== SETTINGS TAB ===== -->
            <div class="tab-panel" id="panelSettings">
                <section class="card">
                    <div class="card-header">
                        <h2>إعدادات الاتصال</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="autoGraderUrl">عنوان AutoGrader Dashboard</label>
                            <div class="input-with-btn">
                                <input type="url" id="autoGraderUrl" class="input" value="http://localhost:5173"
                                    placeholder="http://localhost:5173">
                                <button class="btn btn-primary btn-sm" id="testConnectionBtn">
                                    <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                                        <path
                                            d="M10 2C5.58 2 2 5.58 2 10s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm1 13H9v-2h2v2zm0-4H9V5h2v6z" />
                                    </svg>
                                    اختبار
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="card">
                    <div class="card-header">
                        <h2>خيارات متقدمة</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="maxRetries">عدد محاولات إعادة الإرسال</label>
                            <select id="maxRetries" class="input">
                                <option value="1">1 محاولة</option>
                                <option value="3" selected>3 محاولات</option>
                                <option value="5">5 محاولات</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="extractionTimeout">مهلة الاستخراج (ثانية)</label>
                            <select id="extractionTimeout" class="input">
                                <option value="15">15 ثانية</option>
                                <option value="30" selected>30 ثانية</option>
                                <option value="60">60 ثانية</option>
                            </select>
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="autoSaveOption" checked>
                            <span class="checkmark"></span>
                            <span>حفظ نسخة احتياطية تلقائياً</span>
                        </label>
                        <label class="checkbox-label" style="margin-top: 8px;">
                            <input type="checkbox" id="notificationsOption" checked>
                            <span class="checkmark"></span>
                            <span>إشعارات الإرسال</span>
                        </label>
                    </div>
                </section>

                <section class="card">
                    <div class="card-header">
                        <h2>حول الإضافة</h2>
                    </div>
                    <div class="card-body about-section">
                        <div class="about-logo">
                            <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                                <rect width="32" height="32" rx="8" fill="#3b82f6" />
                                <path d="M16 6L22 11L16 16L10 11L16 6Z" fill="white" />
                                <path d="M16 16L22 21L16 26L10 21L16 16Z" fill="white" opacity="0.65" />
                            </svg>
                            <div>
                                <strong>AutoGrader Smart Scraper</strong>
                                <span class="version-badge">v2.1.0</span>
                            </div>
                        </div>
                        <p class="about-desc">أداة استخراج بيانات ذكية مدعومة بالتحليل الدلالي ومحرك المرونة.</p>
                    </div>
                </section>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-inner">
                <span>AutoGrader AI</span>
                <span class="footer-sep">•</span>
                <span>v2.1.0</span>
                <span class="footer-sep">•</span>
                <span id="footerExtractionCount">0 عملية استخراج</span>
            </div>
        </footer>
    </div>

    <!-- Data Preview Modal -->
    <div class="modal-overlay" id="previewModal" style="display: none;">
        <div class="modal-card">
            <div class="modal-header">
                <h3>معاينة البيانات المستخرجة</h3>
                <button class="btn-icon" id="closePreviewBtn">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4.5 4.5L15.5 15.5M15.5 4.5L4.5 15.5" stroke="currentColor" stroke-width="2"
                            fill="none" stroke-linecap="round" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="preview-stats-grid" id="previewStats"></div>
                <div class="preview-data-box" id="previewData"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelPreviewBtn">إلغاء</button>
                <button class="btn btn-success" id="confirmSendBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2L15 22L11 13M11 13L2 9L22 2" />
                    </svg>
                    إرسال إلى AutoGrader
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="resilience-engine.js"></script>
    <script src="telemetry-profiler.js"></script>
    <script src="semantic-analyzer.js"></script>
    <script src="smart-extractor.js"></script>
    <script src="autograder-integration.js"></script>
    <script src="enhanced-popup.js"></script>
</body>

</html>